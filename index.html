<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="tailwind.css">
    <title>Meal App</title>
</head>
<body>

    <div class="flex flex-col items-center container mx-auto px-4 ">
        <!--Titre de la recette-->
        <h1 id="meal" class="text-5xl font-black">Titre de la recette</h1>
        <!--Image de la recette-->
        <div class="my-8 rounded-xxl shadow-lg overflow-hidden">
            <img id='imageMeal' width="256" src="https://user-media-prod-cdn.itsre-sumo.mozilla.net/uploads/images/2016-09-21-05-08-41-46dd20.png" />
        </div>
        <!--Bouton favoris-->
        <div class="p-2 bg-pink-50 rounded mb-6">
            <a  class="text-pink-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 mb-1" onclick="addFav(currentMeal)">Ajouter aux favoris</a>
        </div>
        <!--Liste des ingrédients-->
        <div id="list-ingredient" class="flex flex-row flex-wrap">
        <!--Instructions-->
        </div>
        <p id="instructions" class="rounded bg-gray-50 p-4">Loading instructions...</p>
    </div>
    <!--Menu-->
    <div class="flex flex-col items-end container mx-auto px-4" >
        <ul >
            <li class="text-pink-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 mb-1"><a href="index.html" >Accueil</a></li>
            <li class="text-pink-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 mb-1"><a href="fav.html" >Mes fav's</a></li>
            <li class="text-pink-500 background-transparent font-bold uppercase px-6 py-2 text-sm outline-none focus:outline-none mr-1 mb-1" ><a href="week.html" >Ma semaine</a></li>
        </ul>
    </div>


    <script>
        var currentMeal;
        //insérer les données de l'api au bon endroit grace aux ID
        const ul = document.getElementById("list-ingredient");
        const instructions = document.getElementById("instructions");
        const mealTitle = document.getElementById("meal");
        const imageMeal = document.getElementById("imageMeal");


        
        //Charge une recette random
        function loadRandomRecipe() {
            //1. Se connecter à l'API MealDB
            //On cree la requete
            let requestURL = 'https://www.themealdb.com/api/json/v1/1/random.php';
            let request = new XMLHttpRequest();
            request.open('GET', requestURL);
            request.responseType = 'text';
            
             //2. Récuperer une recette random
            //Envoi de la requete
            request.send();

            //Au moment de la récupération (réponse du serveur)
            request.onload = function() {
                //On execute ce code
                const mealText = request.response;
                currentMeal = JSON.parse(mealText);
                //console.log(meals);
                showMeal(meals);
            }
        }
   
        //3. L'afficher de manière jolie
        function showMeal(currentMeal){
            //On va boucler sur les données
            var myRecipe = dataFromServer.meals[0];
            
            //Ingredients List
            for(var i=1; i <= 20; i++){
                ingredientValue = myRecipe["strIngredient" + i];
                if(ingredientValue !== ''){
                    const ingredient = document.createElement('div');
                    ingredient.className = 'm-2 p-2 bg-indigo-200 rounded text-indigo-900';
                    ingredient.textContent = ingredientValue;
                    //pour insérer entre les balises ul
                    ul.appendChild(ingredient);
                }
            }
            
            //Instructions
            instructionsValue = myRecipe.strInstructions;
            instructions.innerHTML= instructionsValue;
            
            //Title 
            mealTitleValue = myRecipe.strMeal;
            mealTitle.innerHTML = mealTitleValue;

            //image
            imageValue=myRecipe.strMealThumb;
            imageMeal.src=imageValue;

        }

        loadRandomRecipe();

        //4. Ajouter en favoris
        // Créer/Modifier un fichier JSON avec le tableau des recettes

        function addFav(dataFromServer, i){
            
            //je récupère le localStorage
            if(JSON.parse(localStorage.getItem("favs")) !=null){
                var tableauFav=[JSON.parse(localStorage.getItem("favs"))];
            console.log(tableauFav);
            }else{
                tableauFav=[];
            }
            
            // je récupère ma recette
            var myRecipe = dataFromServer.meals[0];
            //je crée un objet Json avec mes données
            let objJson = {
                title : myRecipe.strMeal,
                instructions : myRecipe.strInstructions,
                image : myRecipe.strMealThumb,
                ingredient1 : myRecipe.strIngredient1,
                ingredient2 : myRecipe.strIngredient2,
                ingredient3 : myRecipe.strIngredient3,
                ingredient4 : myRecipe.strIngredient4,
                ingredient5 : myRecipe.strIngredient5,
                ingredient6 : myRecipe.strIngredient6,
                ingredient7 : myRecipe.strIngredient7,
                ingredient8 : myRecipe.strIngredient8,
                ingredient9 : myRecipe.strIngredient9,
                ingredient10 : myRecipe.strIngredient10,
                ingredient11 : myRecipe.strIngredient11,
                ingredient12 : myRecipe.strIngredient12,
                ingredient13 : myRecipe.strIngredient13,
                ingredient14 : myRecipe.strIngredient14,
                ingredient15 : myRecipe.strIngredient15,
                ingredient16 : myRecipe.strIngredient16,
                ingredient17 : myRecipe.strIngredient17,
                ingredient18 : myRecipe.strIngredient18,
                ingredient19 : myRecipe.strIngredient19,
                ingredient20 : myRecipe.strIngredient20,
            }

            tableauFav.push(objJson);

            //je teste en console.log
            console.log(tableauFav);
            //J'enregistre en localStorage
            let objLinea = JSON.stringify(tableauFav);
            localStorage.setItem("favs",objLinea);

        

       }      
    </script>
</body>
</html>


